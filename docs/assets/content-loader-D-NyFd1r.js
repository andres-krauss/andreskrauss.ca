function j(){const m=document.getElementById("gridContainer");if(!m)return console.error("❌ #gridContainer not found in DOM");const A=m.dataset.csv||"data/catalogue/projects-main.csv",H=parseInt(m.dataset.cols)||3,B=getComputedStyle(document.documentElement).getPropertyValue("--gap-default").trim()||"1rem",E="var(--font-mono)",y=B;let p=[];const L=document.createElement("div");Object.assign(L.style,{marginBottom:"2rem",display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center",justifyContent:"center",width:"100%"});const r=document.createElement("input");r.type="text",r.placeholder="Search...",Object.assign(r.style,{padding:"0.5rem",flex:"1",fontFamily:E,fontSize:"1rem",width:window.innerWidth<=600?"100%":"auto"});const c=document.createElement("select"),d=document.createElement("select");[c,d].forEach(e=>{Object.assign(e.style,{padding:"0.5rem",minWidth:"120px",fontFamily:E,fontSize:"1rem",width:window.innerWidth<=600?"100%":"auto"})}),m.parentElement.insertBefore(L,m),L.append(r,c,d);function w(e,t){const i=document.createElement("option");return i.value=e,i.textContent=t,i}function z(e,t){fetch(e).then(i=>i.text()).then(i=>{const n=Papa.parse(i.trim(),{skipEmptyLines:!0});t(n.data)}).catch(i=>console.error("❌ Failed to fetch CSV:",i))}function l(e){return(e==null?void 0:e.trim())||"n/a"}function F(e,t,i,n,s,a,o,u,v,h,x,S,f,O){let C="";const b=l(h);b.startsWith("http")&&(C=`<a href="${b}" target="_blank"><img src="media/icons/linkedin.png" style="width: 25px" alt="LinkedIn"></a>`);const W=O?"max-height: unset;":"max-height: 0; overflow: hidden; transition: max-height 0.3s ease;";return`
        <div class="product_cell-inner" style="box-sizing: border-box; margin-bottom: ${y}; break-inside: avoid; font-family: ${E};">
            <div class="toggle-wrapper" style="position: relative; cursor: pointer;">
                <img src="${l(t)}" alt="${l(i)}" style="width: 100%; height: auto; display: block; object-fit: cover;">
                <div class="reveal-panel" style="${W}">
                    <div style="padding-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <h2 style="margin: 0;">${l(i)}</h2>
                            <div style="display: flex; flex-direction: column; align-items: end; gap: 4px;">
                                <span style="font-size: 0.9rem;">${l(o)}</span>
                                ${C}
                            </div>
                        </div>
                        <ul style="padding-left: 1rem; margin-top: 0.5rem; margin-bottom: 0;">
                            <li> role: ${l(a)} ${l(s)}</li>
                            <li> Inst: ${l(n)}</li>
                            <li> desc: ${l(u)}</li>
                            <li> id: ${l(f)}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>`}function D(e,t){t.innerHTML="",t.style.display="flex",t.style.flexWrap="wrap",t.style.gap=y;const i=[];for(let n=0;n<e;n++){const s=document.createElement("div");Object.assign(s.style,{flex:"1",display:"flex",flexDirection:"column",gap:y,minWidth:`calc(${100/e}% - ${y})`}),i.push(s),t.appendChild(s)}return i}function $(e){const t=window.innerWidth<=600,i=window.innerWidth<=900;let n=H;t?n=1:i&&(n=2);const s=D(n,m);for(let a=0;a<n;a++)for(let o=a;o<e.length;o+=n){const u=e[o];if(u.length>=11){const v=u.map(g=>l(g)),[h,x,S,f,O,C,b,W,G,N,P,V]=v,U=F(o,x,S,f,O,C,b,W,G,N,P,V,h,t),k=document.createElement("div");k.innerHTML=U;const M=k.firstElementChild;if(!t){const g=M.querySelector(".reveal-panel"),q=M.querySelector(".toggle-wrapper");let _=!1,T=null;q.addEventListener("click",()=>{_?(g.style.maxHeight="0",_=!1,clearTimeout(T)):(g.style.maxHeight="500px",_=!0,T=setTimeout(()=>{g.style.maxHeight="0",_=!1},1e4))})}s[a].appendChild(M)}}}function I(){const e=r.value.trim().toLowerCase(),t=c.value.trim(),i=d.value.trim(),n=p.filter(s=>{const[,,a,o,,,u,v]=s.map(f=>(f||"n/a").toLowerCase()),h=a.includes(e)||o.includes(e)||v.includes(e),x=!t||u.includes(t);return h&&x&&(!i||o===i)});$(n)}[r,c,d].forEach(e=>{e.addEventListener("input",I),e.addEventListener("keyup",I)}),z(A,e=>{p=e.slice(1);const t=[...new Set(p.map(n=>n[6].trim()||"n/a"))].sort().reverse(),i=[...new Set(p.map(n=>n[3].trim()||"n/a"))].sort();c.appendChild(w("","All Years")),t.forEach(n=>c.appendChild(w(n,n))),d.appendChild(w("","All Orgs")),i.forEach(n=>d.appendChild(w(n,n))),$(p)}),window.addEventListener("resize",()=>{const t=window.innerWidth<=600?"100%":"auto";r.style.width=t,c.style.width=t,d.style.width=t,$(p)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j):j();
